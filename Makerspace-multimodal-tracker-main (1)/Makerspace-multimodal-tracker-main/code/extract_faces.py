import cv2import pandas as pdimport argparseimport globimport os# KeypointsNose = 0LeftEye = 1RightEye = 2LeftEar = 3RightEar = 4LeftShoulder = 5RightShoulder = 6LeftElbow = 7RightElbow = 8LeftWrist = 9RightWrist = 10LeftHip = 11RightHip = 12LeftKnee = 13RightKnee = 14LeftAnkle = 15RightAnkle = 16# function to create directoriesdef create_dir(target_dir):    if not os.path.exists(target_dir):        try:            os.makedirs(target_dir)        except:            pass        # get images and video info from videodef get_images(videofile):    imgs = []  stream = cv2.VideoCapture(videofile)  assert stream.isOpened(), 'Cannot capture source'  datalen = int(stream.get(cv2.CAP_PROP_FRAME_COUNT))  fps = stream.get(cv2.CAP_PROP_FPS)  frameSize = (int(stream.get(cv2.CAP_PROP_FRAME_WIDTH)), int(stream.get(cv2.CAP_PROP_FRAME_HEIGHT)))  videoinfo = {'datalen': datalen, 'fps': fps, 'frameSize': frameSize}    for i in range (datalen):    (grabbed, frame) = stream.read()    imgs.append(frame)  stream.release()  return imgs, videoinfo# get x, y coordinates for given keypoint and imagedef get_keypoint_coordinates(keypoints_list, keypoint):    x = keypoints_list[keypoint*3]  y = keypoints_list[keypoint*3+1]    return x, y# get bbox for facedef get_face_bbox(keypoints_list,box_results):  # use keypoints  rightshoulder_x, rightshoulder_y = get_keypoint_coordinates(keypoints_list,RightShoulder)  leftear_x, leftear_y = get_keypoint_coordinates(keypoints_list,LeftEar)  rightear_x, rightear_y = get_keypoint_coordinates(keypoints_list,RightEar)  # use box results  box_results = [box_results[0], box_results[0]+box_results[2], box_results[1], box_results[1]+box_results[3]] # topleft_x,bottomright_x,topleft_y,bottomright_y  # set bbox   buffer_x = 0 # abs(leftear_x - rightear_x) * 0.5  buffer_y = 0 # abs(box_results[2] - rightshoulder_y) * 0.25  topleft_x = box_results[0] # min(leftear_x, rightear_x) - buffer_x  topleft_y = box_results[2] - buffer_y  bottomright_x = box_results[1] # max(leftear_x, rightear_x) + buffer_x  #bottomright_y = rightshoulder_y + buffer_y    # obtain x length  length_x = abs(topleft_x-bottomright_x)  # get square bbox by setting length_y = length_x  bottomright_y = topleft_y + length_x  bbox = [topleft_x,bottomright_x,topleft_y,bottomright_y]  return bbox# extract faces from video and save as imagesdef extract_faces():        # obtain csv files from webcam_process    alpha_info_files = glob.glob(alpha_new_info_folder+'faces_*.csv')        for faces_csv in alpha_info_files:                # get information from df_faces        df_faces = pd.read_csv(faces_csv)        video_id = list(set(df_faces['video_id']))[0]                 # get information from df_info        video_path = df_info[df_info['video_id']==video_id]['video_path'].values[0]        faces_folder = df_info[df_info['video_id']==video_id]['faces_folder'].values[0]        alpha_info_path_post = df_info[df_info['video_id']==video_id]['alpha_info_path_post'].values[0]                # obtain images and videoinfo        imgs, videoinfo = get_images(video_path)                 # extract faces        face_count = 0        df_recognition = pd.DataFrame(columns=['video_id','image_id','face_count','image_path'])                for i, row in df_faces.iterrows():                     # get info            frame = row['image_id']            keypoints_list = eval(row['keypoints'])            box_results = eval(row['box'])                         # get bbox            bbox = get_face_bbox(keypoints_list,box_results)                         # crop image            x1 = min(int(bbox[0]),int(bbox[1]))             x2 = max(int(bbox[0]),int(bbox[1]))             y1 = min(int(bbox[2]),int(bbox[3]))             y2 = max(int(bbox[2]),int(bbox[3]))                          crop_img = imgs[int(frame[:-4])][y1:y2,x1:x2]                        try:                image_path = faces_folder + '{}_{}'.format(face_count,frame)                cv2.imwrite(image_path,crop_img)                df_recognition = df_recognition.append({'video_id':video_id,                                                        'image_id':frame,                                                        'face_count':face_count,                                                        'image_path':image_path},ignore_index=True)                face_count += 1            except:                print('Issue with {}'.format(frame))                # save df_recognition        df_recognition.to_csv(faces_new_info_folder+'{}.csv'.format(video_id),index=0)                # move processed csv        os.rename(faces_csv, alpha_info_path_post)"""----------------------------- options -----------------------------"""parser = argparse.ArgumentParser(description='Extract Faces')parser.add_argument('--output_dir', type=str, default='../outputs/',                    help='location of output drive')args = parser.parse_args()if __name__ == "__main__":        # create necessary variables    code_dir = os.getcwd() +'/'    os.chdir(args.output_dir)    output_dir = os.getcwd() +'/'    os.chdir(code_dir)        # define necessary folders    info_dir = output_dir + 'info/'    alpha_new_info_folder = info_dir + 'alpha_new_info/'    faces_new_info_folder = info_dir + 'faces_new_info/'        # read in df_info    df_info = pd.read_csv(info_dir+'df_info.csv')        # extract faces    extract_faces()    