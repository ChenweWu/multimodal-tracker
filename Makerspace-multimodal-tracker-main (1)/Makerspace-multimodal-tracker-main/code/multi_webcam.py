import multiprocessing as mpimport subprocessimport shleximport argparseimport os# function to execute command in shelldef run_command(command):    process = subprocess.Popen(shlex.split(command), stdout=subprocess.PIPE)    while True:        output = process.stdout.readline()        if process.poll() is not None:            break        if output:            print(output.strip())    rc = process.poll()    return rc# function to create directoriesdef create_dir(target_dir):    if not os.path.exists(target_dir):        try:            os.makedirs(target_dir)        except:            pass    # functions to handle scheduledef start_webcam(f_station,f_webcam,f_webcam_dir,f_recording_time,f_recording_duration):        print('\nStarting webcam process for {}_{}'.format(f_station,f_webcam))        # command for webcam_process    command_line = 'python3 webcam_process.py --station={} --webcam={} --webcam_dir={} --recording_time={} --recording_duration={}'.format(f_station,f_webcam,f_webcam_dir,f_recording_time,f_recording_duration)                # execute in command line    run_command(command_line)    # functions to handle scheduledef start_webcam_post(f_station,f_webcam,f_webcam_dir):            # command for webcam_process    command_line = 'python3 webcam_post_process.py --station={} --webcam={} --webcam_dir={}'.format(f_station,f_webcam,f_webcam_dir)                # execute in command line    run_command(command_line)    """----------------------------- options -----------------------------"""parser = argparse.ArgumentParser(description='Multi Webcam Recording')parser.add_argument('--station', type=int,                    help='id for station')parser.add_argument('--webcams', type=str,                    help='list of ids for webcam')parser.add_argument('--recording_time', type=str,                    help='recording time of webcams format %H:%M')parser.add_argument('--recording_duration', type=str,                    help='duration of webcam recording')parser.add_argument('--output_dir', type=str, default='../outputs/',                    help='location of output drive')args = parser.parse_args()if __name__ == "__main__":        # create necessary variables    code_dir = os.getcwd() +'/'    station_id = args.station    webcam_ids = eval(args.webcams)    recording_time = args.recording_time    recording_duration =args.recording_duration        os.chdir(args.output_dir)    output_dir = os.getcwd() +'/'    os.chdir(code_dir)            # create folders     station_dir = output_dir + 'station_{}/'.format(station_id)    create_dir(station_dir)        webcam_dirs = {}    for webcam_id in webcam_ids:        webcam_dir = station_dir + 'webcam_{}/'.format(webcam_id)        create_dir(webcam_dir)        webcam_dirs[webcam_id] = webcam_dir            # multiprocessing    if station_id == 0:                # webcam recording        r1 = mp.Process(target=start_webcam, args=(station_id,0,webcam_dirs[0],recording_time,recording_duration))        r2 = mp.Process(target=start_webcam, args=(station_id,2,webcam_dirs[2],recording_time,recording_duration))                        # webcam post processing        p1 = mp.Process(target=start_webcam_post, args=(station_id,0,webcam_dirs[0]))        p2 = mp.Process(target=start_webcam_post, args=(station_id,2,webcam_dirs[2]))                # start        r1.start()        r2.start()                p1.start()        p2.start()        elif station_id == 1:                # webcam recording        r1 = mp.Process(target=start_webcam, args=(station_id,0,webcam_dirs[0],recording_time,recording_duration))        r2 = mp.Process(target=start_webcam, args=(station_id,2,webcam_dirs[2],recording_time,recording_duration))        r3 = mp.Process(target=start_webcam, args=(station_id,4,webcam_dirs[4],recording_time,recording_duration))                # webcam post processing        p1 = mp.Process(target=start_webcam_post, args=(station_id,0,webcam_dirs[0]))        p2 = mp.Process(target=start_webcam_post, args=(station_id,2,webcam_dirs[2]))        p3 = mp.Process(target=start_webcam_post, args=(station_id,4,webcam_dirs[4]))                # start        r1.start()        r2.start()        r3.start()                p1.start()        p2.start()        p3.start()        elif station_id == 2:                # webcam recording        r1 = mp.Process(target=start_webcam, args=(station_id,0,webcam_dirs[0],recording_time,recording_duration))        r2 = mp.Process(target=start_webcam, args=(station_id,5,webcam_dirs[5],recording_time,recording_duration))                # webcam post processing        p1 = mp.Process(target=start_webcam_post, args=(station_id,0,webcam_dirs[0]))        p2 = mp.Process(target=start_webcam_post, args=(station_id,5,webcam_dirs[5]))                r1.start()        r2.start()                p1.start()        p2.start()        else:        raise Exception('Invalid Station ID')        #for webcam_id, webcam_dir in webcam_dirs.items():        #mp.Process(target=start_webcam, args=(station_id,webcam_id,webcam_dir,recording_time,recording_duration)).start()            